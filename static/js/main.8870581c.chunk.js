(this["webpackJsonpsbora-dannix"]=this["webpackJsonpsbora-dannix"]||[]).push([[0],{25:function(t){t.exports=JSON.parse('{"_appname":{"title":"Eye Tracker","description":"application title"},"_data_capture_page":{"title":"Data Capture","description":"application title"},"_settings":{"title":"settings","description":"settings literal text"},"_save":{"title":"save","description":"save text"},"_prev":{"title":"prev","description":"prev text literal"},"_next":{"title":"next","description":"next text literal"},"_description":{"title":"description","description":""},"_click_tracker":{"title":"select tracker to start","description":"text for upload control"},"_upload":{"title":"upload","description":"text for upload control"},"_clear":{"title":"\u0441lear","description":"clear text literal, example a button to clear dirty canvas"}}')},26:function(t){t.exports=JSON.parse('{"_appname":{"title":"Eye Tracker","description":"application title"},"_data_capture_page":{"title":"Data Capture","description":"application title"},"_save":{"title":"save","description":"save text"},"_prev":{"title":"prev","description":"prev text literal"},"_next":{"title":"next","description":"next text literal"},"_description":{"title":"description","description":""},"_upload":{"title":"upload","description":"text for upload control"},"_clear":{"title":"\u0441lear","description":"clear text literal, example a button to clear dirty canvas"}}')},29:function(t){t.exports=JSON.parse("[]")},30:function(t){t.exports=JSON.parse('[{"caption":"_appname","link":"/"},{"caption":"_data_capture_page","link":"/data_capture"}]')},31:function(t,e,a){t.exports=a(46)},36:function(t,e,a){},44:function(t,e,a){},45:function(t,e,a){},46:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=a(24),s=a.n(i),o=(a(36),a(3)),c=a(4),l=a(6),d=a(7),u=a(13),h=a(11),m={en:a(25),ru:a(26)},p={getAgentLocale:function(){return(localStorage.getItem("_locale")||navigator.language||navigator.userLanguage||"ru").slice(0,2)}};var g={TextUtils:{hashCode:function(t){var e,a=0;if(0===t.length)return a;for(e=0;e<t.length;e++)a=(a<<5)-a+t.charCodeAt(e),a|=0;return Math.abs(a)},getLocalCaption:function(t){var e=p.getAgentLocale();return m[e][t]?m[e][t].title:m.en[t]?m.en[t].title:""}},AgentUtils:p,LoadExternelScript:function(t){return new Promise((function(e,a){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=e,n.onerror=a,n.onreadystatechange=function(){"complete"===n.readyState&&n.onload()},document.head.appendChild(n)}))}},v=function(t){return function(e){Object(d.a)(n,e);var a=Object(l.a)(n);function n(){var t;Object(o.a)(this,n);for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return(t=a.call.apply(a,[this].concat(r))).state={didMount:!1},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;setTimeout((function(){t.setState({didMount:!0})}),0)}},{key:"render",value:function(){var e=this.state.didMount;return r.a.createElement("div",{className:"fade-in ".concat(e&&"visible")},r.a.createElement(t,this.props))}}]),n}(r.a.Component)},f=v(function(t){Object(d.a)(a,t);var e=Object(l.a)(a);function a(){return Object(o.a)(this,a),e.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:""},r.a.createElement("div",{className:"container-fluid mt-5"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12 h5"},g.TextUtils.getLocalCaption("_home_lead")),r.a.createElement("div",{className:"col-12"},g.TextUtils.getLocalCaption("_description")))))}}]),a}(r.a.Component)),b=a(10),y=a(14),x=a(15),_=function(t){Object(d.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(o.a)(this,a),(n=e.call(this,t)).state={show_modal:!1},n.toggleModal=n.toggleModal.bind(Object(b.a)(n)),n}return Object(c.a)(a,[{key:"toggleModal",value:function(){this.setState({show_modal:!this.state.show_modal})}},{key:"getstyle",value:function(){if(this.state.show_modal)return{display:"block"}}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{type:"button",className:this.props.buttonClass||"btn btn-primary",onClick:this.toggleModal},this.props.caption||"..."),r.a.createElement("div",{className:"modal fade "+(this.state.show_modal?" show":""),tabIndex:"-1",role:"dialog",style:this.getstyle()},r.a.createElement("div",{className:"modal-dialog modal-lg"},r.a.createElement("div",{className:"modal-content p-1"},r.a.createElement("div",{className:"col-12 text-right"},r.a.createElement("button",{type:"button",className:"btn btn-transparent",onClick:this.toggleModal},r.a.createElement(y.a,{icon:x.b,className:"text-danger"}))),r.a.createElement("div",{className:"p-3"},this.props.children)))))}}]),a}(r.a.Component),k=a(17),E=function(){function t(e){var a=this;Object(o.a)(this,t),this.state={canvas:e.canvas,x:e.x||0,y:e.y||0,w:e.w||10,h:e.h||10,object:e.object,object_index:0,history:[],fxy:e.fxy,freq:e.freq||5e3},this.update=this.update,this.getHistory=function(){return a.state.history}}return Object(c.a)(t,[{key:"cycleIndex",value:function(t,e){return t>e.length-2?0:t+1}},{key:"update",value:function(){var t=this.state.history.length,e=(new Date).getTime();if(t){if(e-this.state.history[t-1].date>this.state.freq){var a;if(this.state.fxy)a=this.state.fxy(this.state.x,this.state.y,this.state.canvas.width,this.state.canvas.height);else a={x:Math.floor(1e3*Math.random())%this.state.canvas.width,y:Math.floor(1e3*Math.random())%this.state.canvas.height};var n=this.state.history,r=Object(k.a)({},a,{date:e});if(n[0]=r,this.state.x=a.x,this.state.y=a.y,this.state.history=n,Array.isArray(this.state.object)){var i=this.state.object_index;this.state.object_index=this.cycleIndex(i,this.state.object)}}}else this.state.x=0,this.state.y=0,this.state.history=[{x:0,y:0,date:e}];var s=this.state.canvas.getContext("2d");return s.strokeStyle="rgb(255, 0, 0)",s.fillStyle="rgb(255, 0, 0)",Array.isArray(this.state.object)?(s.font="18px serif",s.fillText(this.state.object[this.state.object_index],this.state.x,this.state.y)):s.fillRect(this.state.x,this.state.y,this.state.w,this.state.h),{x:this.state.x,y:this.state.y}}}]),t}(),w=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;Object(o.a)(this,t),this.run=function(t,i,s,o){return(t+e<=0||t+e>=s)&&(e*=-1,a+=r),a>=1&&(a+=r*=-1),(i=Math.abs(a*t+n))-o>0&&(a*=-1),i=Math.abs(a*t+n),{x:t+=e,y:i}}},j=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;Object(o.a)(this,t),this.run=function(t,n,r,i){return(t+e<=0||t+e>=r)&&(e*=-1,(a+=.1)>1&&(a=.1)),n=i*Math.sin(a*t/r*Math.PI),{x:t+=e,y:n}}},N=function(t){Object(d.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(o.a)(this,a),(n=e.call(this,t)).state={width:t.width||800,height:t.height||600,frame_rate:30,flip:!0,tracker:{freq:100,name:null},recording:0,sessions:[]},n.stream_src=null,n.stream_stage=null,n.setStream_src=function(t){n.stream_src=t},n.setStream_stage=function(t){n.stream_stage=t},n.paintCanvas=n.paintCanvas.bind(Object(b.a)(n)),n.selectRunner=n.selectRunner.bind(Object(b.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.startStream()}},{key:"selectRunner",value:function(t){var e={ZigZag:new w(10,.5),Wavey:new j(10)},a=1;t.target.id===this.state.tracker.name&&(-1===this.state.recording&&(a=0),1===this.state.recording&&(a=-1));var n=e[t.target.id]?e[t.target.id].run:null,r=this.state.tracker;(r=Object(k.a)({},r,{canvas:this.stream_stage,fxy:n,name:t.target.id})).tracker=new E(r),this.setState({tracker:r,recording:a})}},{key:"startStream",value:function(){var t=this.stream_src;navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then((function(e){t.srcObject=e})).catch((function(t){console.log("Something went wrong!")}))}},{key:"paintCanvas",value:function(){var t=this,e=[];setInterval((function(){var a=t.stream_stage,n=a.getContext("2d");if(n.clearRect(0,0,a.width,a.height),n.drawImage(t.stream_src,0,0,a.width,a.height),t.state.recording){var r=t.state.tracker.tracker.update();if(-1===t.state.recording){console.log(r);var i=n.getImageData(0,0,a.width,a.height);e.push({point:r,frame:i}),e.length>5*t.state.frame_rate&&(e=[])}}}),1e3/this.state.frame_rate)}},{key:"getCanvasSettings",value:function(){return this.state}},{key:"getPlayButton",value:function(t){var e="btn btn-transparent border-primary",a=t;return this.state.tracker.name===t&&(e="btn btn-warning border-primary",a=r.a.createElement(r.a.Fragment,null,t),-1===this.state.recording&&(e="btn btn-success border-primary",a=r.a.createElement(r.a.Fragment,null,t," ",r.a.createElement(y.a,{icon:x.a,className:"text-primary"})))),r.a.createElement("button",{className:e,id:t,onClick:this.selectRunner},a)}},{key:"render",value:function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12 border-right border-primary border-2x py-0"},r.a.createElement("h5",{className:"col-12"},g.TextUtils.getLocalCaption("_click_tracker")),r.a.createElement("div",{className:"btn-group my-3"},this.getPlayButton("ZigZag"),this.getPlayButton("Wavey"),this.getPlayButton("Random")),r.a.createElement("canvas",{width:this.state.width,height:this.state.height,ref:this.setStream_stage,className:""}),r.a.createElement("video",{ref:this.setStream_src,className:"invisible",height:"1",onPlay:this.paintCanvas,autoPlay:!0})))}}]),a}(r.a.Component),C=v(function(t){Object(d.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(o.a)(this,a),(n=e.call(this,t)).state={document:{subject:{},experiments:[]},settingsCollapsed:!1},n.toggleSettingsBar=n.toggleSettingsBar.bind(Object(b.a)(n)),n}return Object(c.a)(a,[{key:"getSettingsPane",value:function(){return r.a.createElement(r.a.Fragment,null)}},{key:"toggleSettingsBar",value:function(){this.setState({settingsCollapsed:!this.state.settingsCollapsed})}},{key:"render",value:function(){return r.a.createElement("div",{className:""},r.a.createElement("div",{className:"container-fluid mt-5"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12 d-lg-none"},r.a.createElement(_,null,r.a.createElement("h5",null,g.TextUtils.getLocalCaption("_settings")),this.getSettingsPane())),r.a.createElement("div",{className:"col-12 "+(this.state.settingsCollapsed?"col-lg-11":"col-lg-8")},r.a.createElement(N,null)),r.a.createElement("div",{className:"d-none d-lg-block "+(this.state.settingsCollapsed?"col-lg-1":"col-lg-4")},r.a.createElement("h5",null,!this.state.settingsCollapsed&&g.TextUtils.getLocalCaption("_settings")),this.getSettingsPane()))))}}]),a}(r.a.Component)),O=function(t){var e=Object(h.e)();document.addEventListener("click",(function(t){if(!t.target.classList.contains("dropdown-toggle"))for(var e=document.getElementsByClassName("dropdown-menu"),a=0;a<e.length;++a)e[a].classList.remove("show")}));var a=function(t){for(var e=t.target.id,a=document.getElementsByClassName("dropdown-menu"),n=0;n<a.length;++n)a[n].getAttribute("aria-labelledby")===e?a[n].classList.add("show"):a[n].classList.remove("show")},n=function(t,e){return"nav-item text-white bg-transparent no-underline "+function(t){switch(t){case 2:return"border-bottom border-2x border-white";case 1:return"border-bottom border-2x border-danger";default:return"border-none"}}(t)+" "+e};return r.a.createElement("nav",{className:"navbar navbar-dark bg-primary fixed-top "+t.className},t.navs.map((function(t){return function t(i){var s="",o=e.pathname===i.link?1:0,c="link_id_"+g.TextUtils.hashCode(i.link),l=arguments[1]?"dropdown-item text-left px-0":"";if(i.children){s=i.children.map((function(e){return t(e,!0)}));for(var d=0;d<s.length;++d)s[d].active&&(o=2);return{active:o,html:r.a.createElement("span",{key:c,className:"dropdown show"},r.a.createElement(u.b,{key:i.link,className:n(o),onClick:a,to:i.link},g.TextUtils.getLocalCaption(i.caption)),"\xa0",r.a.createElement("span",{className:"dropdown-toggle text-white",id:c,onClick:a,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}),r.a.createElement("div",{className:"dropdown-menu bg-primary px-3 text-left","aria-labelledby":c},s.map((function(t){return t.html}))))}}return{active:o,html:r.a.createElement("span",{key:c},r.a.createElement(u.b,{key:i.link,className:n(o,l),to:i.link},g.TextUtils.getLocalCaption(i.caption)))}}(t).html})))},S=a(29),M=a(30),L=(a(44),a(45),function(t){Object(d.a)(a,t);var e=Object(l.a)(a);function a(){return Object(o.a)(this,a),e.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(u.a,{basename:""},sessionStorage.getItem("user")&&r.a.createElement(O,{navs:S,className:"mb-5"})||r.a.createElement(O,{navs:M,className:"mb-5"}),r.a.createElement(h.a,{exact:!0,path:"/",component:f}),r.a.createElement(h.a,{exact:!0,strict:!0,path:"/data_capture",render:function(t){return r.a.createElement(C,t)}}))}}]),a}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.8870581c.chunk.js.map